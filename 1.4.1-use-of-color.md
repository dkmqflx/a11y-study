# [Use of Color (Level A)](https://www.w3.org/WAI/WCAG21/Understanding/use-of-color)

> Color is not used as the only visual means of conveying information, indicating an action, prompting a response, or distinguishing a visual element.

- In A11y, "caution against color-dependent information" means addressing the issue where users with color vision deficiencies (color blindness, low vision, etc.) cannot distinguish information solely based on color. To solve this, it's important to provide additional visual cues or alternative methods beyond color.

---

## 1. Using Icons, Patterns, and Textures

- **Description**: Instead of relying solely on color to convey information, enhance distinguishability by adding icons, dotted lines, hatching patterns, or textures.

- **Examples**:

  - Instead of bar charts distinguished only by colors, apply different patterns (stripes, dots, etc.) to each bar.

  - Distinguish error states (red) and success states (green) not just by color but also with icons (e.g., X icon, check icon).

### 1. Use the `variant` property to add icons alongside colors for buttons and alert components.

```tsx
import { Button } from "@/components/ui/button";
import { Check, X } from "lucide-react";

<Button variant="success">
  <Check className="mr-2 h-4 w-4" /> // success
</Button>

<Button variant="destructive">
  <X className="mr-2 h-4 w-4" /> // error
</Button>
```

### 2. Add background patterns using utility classes like `bg-stripes` or custom SVG patterns.

```css
.striped {
  background-image: linear-gradient(
    45deg,
    rgba(0, 0, 0, 0.1) 25%,
    transparent 25%,
    transparent 50%,
    rgba(0, 0, 0, 0.1) 50%,
    rgba(0, 0, 0, 0.1) 75%,
    transparent 75%,
    transparent
  );
  background-size: 40px 40px;
}
```

## 2. Adding Text Labels

- **Description**: Clearly convey information through text rather than relying on color. For example, explicitly state the status with text instead of indicating it only through color.

- **Examples**:

  - Add "Error" text label instead of just "red = error"

  - Display "This field is required" message instead of just using a red border for form input fields.

### 1. Explicitly display error messages in form validation.

```tsx
import { z } from "zod";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";

const schema = z.object({
  username: z.string().min(1, "Username is required."),
});

export function Form() {
  const {
    register,
    formState: { errors },
  } = useForm({
    resolver: zodResolver(schema),
  });

  return (
    <form>
      <input
        {...register("username")}
        className={`border ${
          errors.username ? "border-red-500" : "border-gray-300"
        }`}
      />
      {errors.username && (
        <span className="text-red-500">{errors.username.message}</span>
      )}
    </form>
  );
}
```

### 2. Use `Form` component and `FormMessage` to display error messages.

```tsx
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";

<FormField
  name="username"
  render={({ field }) => (
    <FormItem>
      <FormLabel>User name</FormLabel>
      <FormControl>
        <Input {...field} />
      </FormControl>
      // display error message
      <FormMessage />
    </FormItem>
  )}
/>;
```

## 3. Maintaining Sufficient Contrast

- **Description**: While users with color vision deficiencies may have difficulty distinguishing colors, they can better differentiate elements when there is sufficient contrast. Follow WCAG guidelines for minimum contrast ratios (4.5:1 for normal text, 3:1 for large text).

- **Examples**:

  - When red and green buttons have similar brightness, they become difficult to distinguish, so increase contrast or add additional cues beyond color.

### 1. Use `contrast` utility or color palettes with high contrast ratios.

- [tailwindcss - Contrast](https://v3.tailwindcss.com/docs/contrast)

-

```tsx
<button className="bg-blue-700 text-white contrast-125">Submit</button>
```

### 2. Test color combinations with Color Oracle and verify contrast ratios with WebAIM Contrast Checker.

- [Color Oracle: ](https://colororacle.org/)

  - Color Oracle is free software that applies color blindness filters to the entire screen, simulating the vision of users with various types of color vision deficiencies. It helps web designers and developers directly verify how their designs appear to users with different types of color blindness.

  - Color Oracle can test the distinguishability of color combinations for users with color vision deficiencies.

  - Example: Red "Delete" and green "Confirm" buttons might both appear gray to color-blind users. Using Color Oracle helps identify such issues early and implement solutions like adding icons (X, V) or clarifying text.

- [WebAIM Contrast Checker: ](https://webaim.org/resources/contrastchecker/)

  - WebAIM Contrast Checker is an online tool that checks whether the luminosity contrast ratio between text and background colors meets the minimum requirements of Web Content Accessibility Guidelines (WCAG).

  - WebAIM Contrast Checker verifies text **readability (contrast ratio)** for users with low vision and general users.

  - Example: Light gray text on a white background may have insufficient contrast and be difficult to read. This tool helps select colors with appropriate contrast ratios or adjust text/background colors to improve readability.

### 3. Add the `a11y` addon to Storybook to check for contrast issues in components during development.

- [Accessibility testing with Storybook](https://storybook.js.org/tutorials/ui-testing-handbook/react/en/accessibility-testing/)

- It automatically performs accessibility checks (including contrast) every time you develop and verify components within Storybook, providing instant feedback.

```bash
npm install @storybook/addon-a11y
```

```js
// .storybook/main.js
module.exports = {
  addons: ["@storybook/addon-a11y"],
};
```

## 4. Utilizing ARIA Attributes

- **Description**: Use ARIA attributes to convey color information as text for screen reader users.

- **Examples**:

  - Describe color-indicated states using `aria-label` or `aria-describedby`.

### 1. Add ARIA attributes to buttons and status indicators.

```tsx
<div
  role="status"
  aria-label="Error status"
  className="bg-red-500 text-white p-2"
>
  An error has occurred
</div>
```

### 2. Customize ARIA attributes for the `Alert` component.

```tsx
import { Alert, AlertDescription, AlertTitle } from "@/components/ui/alert";

<Alert role="alert" aria-describedby="error-desc">
  <AlertTitle>Error</AlertTitle>
  <AlertDescription id="error-desc">
    Unable to process the request.
  </AlertDescription>
</Alert>;
```

## 5. Diversifying Color Palettes by State

- **Description**: When designing color palettes, consider color vision deficiencies by using different hues and lightness values.

- **Examples**:

  - Red (#FF0000) and green (#00FF00) are difficult for colorblind users to distinguish, so add clearly distinguishable colors like blue (#0000FF) or yellow (#FFFF00).

- Customize the color palette to define accessible color combinations.

```js
// tailwind.config.js
module.exports = {
  theme: {
    extend: {
      colors: {
        success: "#1a9850", // Accessible green
        error: "#d73027", // Accessible red
        info: "#457fca", // Accessible blue
      },
    },
  },
};
```

## 6. Testing and Validation

- Combination of jest + @testing-library/react + jest-axe

```bash
npm install --save-dev jest @testing-library/react jest-axe
```

```tsx
// MyComponent.test.tsx
import { render } from "@testing-library/react";
import { axe, toHaveNoViolations } from "jest-axe";
import MyComponent from "./MyComponent";

expect.extend(toHaveNoViolations);

test("should have no accessibility violations", async () => {
  const { container } = render(<MyComponent />);
  const results = await axe(container);
  expect(results).toHaveNoViolations();
  // toHaveNoViolations(results) checks if the violations array in this object is empty
  // -> results.violations.length === 0 must be true to pass
});
```

- **Github Actions**: Add accessibility testing to CI/CD pipeline to detect issues before deployment.

```yaml
name: Accessibility Test
on: [push]
jobs:
test:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v3
    - run: npm install
    - run: npm test -- --a11y
```
